<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–§–ò–ù–ê–ù–°–û–í–´–ô –ë–£–ù–ö–ï–†: –≠–ö–°–¢–†–ò–ú-–í–ï–†–°–ò–Ø</title>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #e74c3c;
            --success: #27ae60;
            --warning: #f39c12;
            --info: #3498db;
            --epic: #8e44ad;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            color: #333;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
        }
        
        .game-header {
            text-align: center;
            margin-bottom: 30px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            padding: 20px;
        }
        
        .game-phase {
            display: none;
            animation: fadeIn 0.5s ease-in;
        }
        
        .game-phase.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .teams-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .team-card {
            background: white;
            border: 3px solid #bdc3c7;
            border-radius: 15px;
            padding: 20px;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            position: relative;
        }
        
        .team-card.winner {
            border-color: var(--success);
            box-shadow: 0 0 30px rgba(39, 174, 96, 0.6);
            background: linear-gradient(135deg, #fff, #d5f5e3);
            animation: winnerGlow 2s infinite;
        }
        
        @keyframes winnerGlow {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }
        
        .team-card.eliminated {
            opacity: 0.6;
            background: #f8d7da;
            animation: eliminatedShake 0.5s ease-in;
        }
        
        @keyframes eliminatedShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        
        .budget {
            font-size: 1.4em;
            font-weight: bold;
            color: var(--success);
            margin: 10px 0;
        }
        
        .insurance-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 8px;
            margin: 15px 0;
        }
        
        .insurance-card {
            background: var(--info);
            color: white;
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s ease;
            border: 2px solid transparent;
            font-size: 0.85em;
        }
        
        .insurance-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .insurance-card.selected {
            background: var(--success);
            border-color: white;
            animation: selectedPulse 1s infinite;
        }
        
        @keyframes selectedPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .insurance-card.disabled {
            background: #95a5a6;
            cursor: not-allowed;
            opacity: 0.6;
        }
        
        .insurance-card.epic {
            background: linear-gradient(135deg, var(--epic), #9b59b6);
            border: 2px dashed gold;
        }
        
        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 30px 0;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--success), #2ecc71);
            color: white;
        }
        
        .btn-danger {
            background: linear-gradient(135deg, var(--secondary), #c0392b);
            color: white;
        }
        
        .btn-epic {
            background: linear-gradient(135deg, var(--epic), #8e44ad);
            color: white;
            animation: epicButton 2s infinite;
        }
        
        @keyframes epicButton {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }
        
        .event-card {
            background: linear-gradient(135deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: center;
            animation: eventPulse 2s infinite;
        }
        
        @keyframes eventPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }
        
        .event-card.critical {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            animation: criticalPulse 1s infinite;
        }
        
        @keyframes criticalPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .event-card.lucky {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
        }
        
        .combo-counter {
            position: fixed;
            top: 20px;
            left: 20px;
            background: var(--epic);
            color: white;
            padding: 10px 20px;
            border-radius: 10px;
            font-weight: bold;
            z-index: 1000;
        }
        
        .achievement {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, gold, #ffd700);
            color: #333;
            padding: 20px 40px;
            border-radius: 15px;
            font-weight: bold;
            font-size: 1.5em;
            z-index: 1000;
            animation: achievementPop 2s ease-out;
            text-align: center;
        }
        
        @keyframes achievementPop {
            0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
            50% { transform: translate(-50%, -50%) scale(1.2); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }
        
        .risk-meter {
            height: 10px;
            background: #ecf0f1;
            border-radius: 5px;
            margin: 10px 0;
            overflow: hidden;
        }
        
        .risk-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--success), var(--warning), var(--secondary));
            transition: width 0.5s ease;
        }
        
        .timer {
            font-size: 2em;
            font-weight: bold;
            text-align: center;
            color: var(--secondary);
            margin: 20px 0;
            animation: timerPulse 1s infinite;
        }
        
        @keyframes timerPulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        
        @media screen and (max-width: 768px) {
            .teams-grid {
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 20px;
                overflow-y: auto;
            }

            .team-card {
                width: 90%;
                max-width: 400px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="phaseInsurance" class="game-phase active">
            <div class="game-header">
                <h1>üéÆ –§–ò–ù–ê–ù–°–û–í–´–ô –ë–£–ù–ö–ï–†: –≠–ö–°–¢–†–ò–ú</h1>
                <p>–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –≤—ã–∂–∏–≤–∞–Ω–∏—è! –í—Ä–µ–º—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–æ!</p>
            </div>
            
            <div class="timer" id="insuranceTimer">02:00</div>
            
            <div class="teams-grid" id="teamsContainer">
            </div>
            
            <div class="controls">
                <button class="btn btn-epic" onclick="startEvents()">‚ö° –ù–ê–ß–ê–¢–¨ –≠–ö–°–¢–†–ò–ú-–†–ê–£–ù–î</button>
            </div>
        </div>

        <div id="phaseEvents" class="game-phase">
            <div class="game-header">
                <h2>üåÄ –≠–ö–°–¢–†–ò–ú-–°–û–ë–´–¢–ò–Ø</h2>
                <p>–¶–µ–ø–æ—á–∫–∞ —Å–æ–±—ã—Ç–∏–π! –£—Å–ø–µ–π—Ç–µ —Å—Ä–µ–∞–≥–∏—Ä–æ–≤–∞—Ç—å!</p>
            </div>
            
            <div class="combo-counter" id="comboCounter" style="display: none;">
                üî• –¶–µ–ø–æ—á–∫–∞: <span id="comboValue">0</span>
            </div>
            
            <div class="event-card" id="currentEvent">
                <h3>–ü—Ä–∏–≥–æ—Ç–æ–≤—å—Ç–µ—Å—å –∫ –ø–µ—Ä–≤–æ–º—É —Å–æ–±—ã—Ç–∏—é!</h3>
            </div>
            
            <div class="teams-grid" id="eventsContainer">
            </div>
            
            <div class="controls">
                <button class="btn btn-danger" onclick="triggerEvent()">üé≤ –ó–ê–ü–£–°–¢–ò–¢–¨ –°–û–ë–´–¢–ò–ï</button>
                <button class="btn btn-epic" onclick="triggerCriticalEvent()">üíÄ –ö–†–ò–¢–ò–ß–ï–°–ö–û–ï –°–û–ë–´–¢–ò–ï</button>
                <button class="btn btn-primary" onclick="showResults()">üèÜ –ó–ê–í–ï–†–®–ò–¢–¨</button>
            </div>
        </div>

        <div id="phaseResults" class="game-phase">
            <div class="game-header">
                <h2>üèÜ –†–ï–ó–£–õ–¨–¢–ê–¢–´ –≠–ö–°–¢–†–ò–ú-–ò–ì–†–´</h2>
                <p>–í—ã–∂–∏–≤—à–∏–µ –ø–æ–ø–∞–¥–∞—é—Ç –≤ –§–∏–Ω–∞–Ω—Å–æ–≤—ã–π –ë—É–Ω–∫–µ—Ä!</p>
            </div>
            
            <div class="teams-grid" id="resultsContainer">
            </div>
            
            <div class="controls">
                <button class="btn btn-epic" onclick="restartGame()">üîÑ –ò–ì–†–ê–¢–¨ –°–ù–û–í–ê</button>
            </div>
        </div>
    </div>

    <script>
        const gameData = {
            teams: [
                {
                    id: 1,
                    role: "–ú–æ–ª–æ–¥–∞—è —Å–µ–º—å—è",
                    budget: 2000000,
                    insurances: [],
                    survived: true,
                    achievements: []
                },
                {
                    id: 2, 
                    role: "–§—Ä–∏–ª–∞–Ω—Å–µ—Ä",
                    budget: 1200000,
                    insurances: [],
                    survived: true,
                    achievements: []
                },
                {
                    id: 3,
                    role: "–ü—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—å", 
                    budget: 3500000,
                    insurances: [],
                    survived: true,
                    achievements: []
                },
                {
                    id: 4,
                    role: "–í—Ä–∞—á",
                    budget: 1800000, 
                    insurances: [],
                    survived: true,
                    achievements: []
                },
                {
                    id: 5,
                    role: "–í–æ–¥–∏—Ç–µ–ª—å",
                    budget: 1500000,
                    insurances: [],
                    survived: true,
                    achievements: []
                },
                {
                    id: 6,
                    role: "–ü–µ–Ω—Å–∏–æ–Ω–µ—Ä",
                    budget: 1000000,
                    insurances: [],
                    survived: true,
                    achievements: []
                }
            ],
            
            insuranceProducts: [
                { id: 1, name: "–°—Ç—Ä–∞—Ö–æ–≤–∫–∞ –∂–∏–∑–Ω–∏", cost: 800000, epic: false },
                { id: 2, name: "–ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∞—è —Å—Ç—Ä–∞—Ö–æ–≤–∫–∞", cost: 700000, epic: false },
                { id: 3, name: "–°—Ç—Ä–∞—Ö–æ–≤–∫–∞ –æ—Ç –∏–Ω–≤–∞–ª–∏–¥–Ω–æ—Å—Ç–∏", cost: 600000, epic: false },
                { id: 4, name: "–ê–≤—Ç–æ—Å—Ç—Ä–∞—Ö–æ–≤–∫–∞", cost: 900000, epic: false },
                { id: 5, name: "–°—Ç—Ä–∞—Ö–æ–≤–∫–∞ –∂–∏–ª—å—è", cost: 1000000, epic: false },
                { id: 6, name: "–ë–∏–∑–Ω–µ—Å-—Å—Ç—Ä–∞—Ö–æ–≤–∫–∞", cost: 1500000, epic: false },
                { id: 7, name: "–°—Ç—Ä–∞—Ö–æ–≤–∫–∞ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏", cost: 500000, epic: false },
                { id: 8, name: "üíé –ú–ï–ì–ê-–°–¢–†–ê–•–û–í–ö–ê", cost: 2000000, epic: true },
                { id: 9, name: "üöÄ –°–¢–†–ê–¢–ï–ì–ò–ß–ï–°–ö–ê–Ø –ó–ê–©–ò–¢–ê", cost: 1800000, epic: true }
            ],
            
            events: [
                { 
                    name: "üî• –ü–û–ñ–ê–† –í –ö–í–ê–†–¢–ò–†–ï", 
                    loss: 1500000,
                    protectedBy: [5, 8],
                    affectedRoles: ["–ú–æ–ª–æ–¥–∞—è —Å–µ–º—å—è", "–ü—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—å"],
                    critical: false
                },
                { 
                    name: "üè• –ó–ê–ë–û–õ–ï–õ –†–ï–ë–ï–ù–û–ö", 
                    loss: 800000,
                    protectedBy: [2, 8],
                    affectedRoles: ["–ú–æ–ª–æ–¥–∞—è —Å–µ–º—å—è"],
                    critical: false
                },
                { 
                    name: "üöó –î–¢–ü –° –ü–û–°–¢–†–ê–î–ê–í–®–ò–ú–ò", 
                    loss: 1800000,
                    protectedBy: [4, 7, 9],
                    affectedRoles: ["–í–æ–¥–∏—Ç–µ–ª—å"],
                    critical: false
                },
                { 
                    name: "üíª –ö–ò–ë–ï–†–ê–¢–ê–ö–ê –ù–ê –ë–ò–ó–ù–ï–°", 
                    loss: 2000000,
                    protectedBy: [6, 9],
                    affectedRoles: ["–ü—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—å"],
                    critical: false
                },
                { 
                    name: "‚ö° –¶–ï–ü–û–ß–ö–ê –ö–†–ò–ó–ò–°–û–í", 
                    loss: 2500000,
                    protectedBy: [8, 9],
                    affectedRoles: ["–ú–æ–ª–æ–¥–∞—è —Å–µ–º—å—è", "–§—Ä–∏–ª–∞–Ω—Å–µ—Ä", "–ü—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—å", "–í—Ä–∞—á", "–í–æ–¥–∏—Ç–µ–ª—å", "–ü–µ–Ω—Å–∏–æ–Ω–µ—Ä"],
                    critical: true
                },
                { 
                    name: "üéâ –§–ò–ù–ê–ù–°–û–í–ê–Ø –£–î–ê–ß–ê", 
                    loss: -1000000,
                    protectedBy: [],
                    affectedRoles: ["–ú–æ–ª–æ–¥–∞—è —Å–µ–º—å—è", "–§—Ä–∏–ª–∞–Ω—Å–µ—Ä", "–ü—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—å", "–í—Ä–∞—á", "–í–æ–¥–∏—Ç–µ–ª—å", "–ü–µ–Ω—Å–∏–æ–Ω–µ—Ä"],
                    critical: false
                }
            ],
            
            usedEvents: [],
            combo: 0,
            eventCount: 0
        };

        function initializeGame() {
            startTimer(120, 'insuranceTimer');
            renderTeams('teamsContainer', true);
        }

        function renderTeams(containerId, showInsurances = false) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';

            gameData.teams.forEach(team => {
                const teamCard = document.createElement('div');
                teamCard.className = `team-card ${!team.survived ? 'eliminated' : ''}`;
                teamCard.id = `team-${team.id}`;
                
                const riskLevel = calculateRiskLevel(team);
                
                let insuranceHTML = '';
                if (showInsurances) {
                    insuranceHTML = `
                        <div class="risk-meter">
                            <div class="risk-fill" style="width: ${riskLevel}%"></div>
                        </div>
                        <p><strong>–£—Ä–æ–≤–µ–Ω—å —Ä–∏—Å–∫–∞: ${riskLevel}%</strong></p>
                        <div class="insurance-grid">
                            ${gameData.insuranceProducts.map(insurance => {
                                const isSelected = team.insurances.find(ins => ins.id === insurance.id);
                                const canAfford = insurance.cost <= team.budget;
                                const canSelect = canAfford && team.insurances.length < 3 && !isSelected;
                                
                                return `
                                    <div class="insurance-card 
                                        ${isSelected ? 'selected' : ''} 
                                        ${insurance.epic ? 'epic' : ''}
                                        ${!canSelect && !isSelected ? 'disabled' : ''}"
                                        onclick="toggleInsurance(${team.id}, ${insurance.id})">
                                        ${insurance.name}<br>
                                        <strong>${formatMoney(insurance.cost)}</strong>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                        <p><strong>–í—ã–±—Ä–∞–Ω–æ:</strong> ${team.insurances.length}/3 | 
                        <strong>–û—Å—Ç–∞–ª–æ—Å—å:</strong> ${formatMoney(team.budget)}</p>
                        ${team.achievements.length > 0 ? 
                            `<p>üèÜ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è: ${team.achievements.join(', ')}</p>` : ''}
                    `;
                }

                teamCard.innerHTML = `
                    <h3>${team.role}</h3>
                    <div class="budget">${formatMoney(team.budget)}</div>
                    ${insuranceHTML}
                    ${!team.survived ? '<div style="color: red; font-weight: bold;">üíÄ –í–´–ë–´–õ–ò</div>' : ''}
                `;
                
                container.appendChild(teamCard);
            });
        }

        function calculateRiskLevel(team) {
            const baseRisk = 100 - (team.insurances.length * 25);
            return Math.max(10, baseRisk);
        }

        function formatMoney(amount) {
            return new Intl.NumberFormat('ru-RU').format(amount) + ' —Ç–≥';
        }

        function switchPhase(phaseName) {
            document.querySelectorAll('.game-phase').forEach(phase => {
                phase.classList.remove('active');
            });
            document.getElementById(`phase${phaseName}`).classList.add('active');
        }

        function startTimer(seconds, elementId) {
            let timeLeft = seconds;
            const timerElement = document.getElementById(elementId);
            
            const timer = setInterval(() => {
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                timerElement.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    if (gameData.currentPhase === 'insurance') {
                        startEvents();
                    }
                }
                timeLeft--;
            }, 1000);
        }

        function toggleInsurance(teamId, insuranceId) {
            const team = gameData.teams.find(t => t.id === teamId);
            const insurance = gameData.insuranceProducts.find(ins => ins.id === insuranceId);
            
            if (!team || !team.survived) return;
            
            const alreadySelected = team.insurances.find(ins => ins.id === insuranceId);
            
            if (alreadySelected) {
                team.insurances = team.insurances.filter(ins => ins.id !== insuranceId);
                team.budget += insurance.cost;
            } else {
                if (team.insurances.length >= 3) {
                    showAchievement("‚ùå –õ–∏–º–∏—Ç —Å—Ç—Ä–∞—Ö–æ–≤–æ–∫!");
                    return;
                }
                if (insurance.cost > team.budget) {
                    showAchievement("üí∏ –ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –¥–µ–Ω–µ–≥!");
                    return;
                }
                team.insurances.push(insurance);
                team.budget -= insurance.cost;
                
                if (insurance.epic) {
                    showAchievement(`üéâ ${team.role} –∫—É–ø–∏–ª –ú–ï–ì–ê-–°–¢–†–ê–•–û–í–ö–£!`);
                    team.achievements.push("–ú–µ–≥–∞-–∑–∞—â–∏—Ç–∞");
                }
            }
            
            renderTeams('teamsContainer', true);
        }

        function startEvents() {
            switchPhase('Events');
            document.getElementById('comboCounter').style.display = 'block';
            renderTeams('eventsContainer', true);
        }

        function triggerEvent() {
            triggerRandomEvent(false);
        }

        function triggerCriticalEvent() {
            triggerRandomEvent(true);
        }

        function triggerRandomEvent(forceCritical = false) {
            gameData.eventCount++;
            
            gameData.combo++;
            document.getElementById('comboValue').textContent = gameData.combo;
            
            let availableEvents = gameData.events.filter(event => 
                !gameData.usedEvents.includes(event.name) && 
                (forceCritical ? event.critical : !event.critical)
            );
            
            if (availableEvents.length === 0) {
                availableEvents = gameData.events.filter(event => 
                    forceCritical ? event.critical : !event.critical
                );
                gameData.usedEvents = [];
            }
            
            const randomEvent = availableEvents[Math.floor(Math.random() * availableEvents.length)];
            gameData.usedEvents.push(randomEvent.name);
            
            const eventElement = document.getElementById('currentEvent');
            eventElement.className = `event-card ${randomEvent.critical ? 'critical' : ''} ${randomEvent.loss < 0 ? 'lucky' : ''}`;
            eventElement.innerHTML = `
                <h3>${randomEvent.name}</h3>
                <p>${randomEvent.loss < 0 ? 'üéâ –ë–û–ù–£–°: +' + formatMoney(-randomEvent.loss) : 'üíÄ –ü–û–¢–ï–†–ò: ' + formatMoney(randomEvent.loss)}</p>
                <p>–ó–∞—Ç—Ä–æ–Ω—É—Ç—ã: ${randomEvent.affectedRoles.join(', ')}</p>
                <p><strong>–ö–æ–º–±–æ: x${gameData.combo}</strong></p>
            `;
            
            let survivors = 0;
            gameData.teams.forEach(team => {
                if (!team.survived) return;
                
                if (randomEvent.affectedRoles.includes(team.role)) {
                    const isProtected = team.insurances.some(ins => 
                        randomEvent.protectedBy.includes(ins.id)
                    );
                    
                    if (isProtected) {
                        team.budget += 100000 * gameData.combo;
                        team.achievements.push("–£—Å–ø–µ—à–Ω–∞—è –∑–∞—â–∏—Ç–∞");
                        showAchievement(`‚úÖ ${team.role} –∑–∞—â–∏—â–µ–Ω!`);
                    } else if (randomEvent.loss < 0) {
                        team.budget += (-randomEvent.loss) * gameData.combo;
                        showAchievement(`üéä ${team.role} –ø–æ–ª—É—á–∏–ª –±–æ–Ω—É—Å!`);
                    } else {
                        const actualLoss = randomEvent.loss * gameData.combo;
                        team.budget -= actualLoss;
                        
                        if (team.budget <= 0) {
                            team.budget = 0;
                            team.survived = false;
                            showAchievement(`üíÄ ${team.role} –í–´–ë–´–õ!`);
                        }
                    }
                }
                
                if (team.survived) survivors++;
            });
            
            if (survivors === 1) {
                showAchievement("üëë –ü–û–°–õ–ï–î–ù–ò–ô –í–´–ñ–ò–í–®–ò–ô!");
            }
            
            renderTeams('eventsContainer', true);
        }

        function showAchievement(text) {
            const achievement = document.createElement('div');
            achievement.className = 'achievement';
            achievement.textContent = text;
            document.body.appendChild(achievement);
            
            setTimeout(() => {
                achievement.remove();
            }, 2000);
        }

        function showResults() {
            switchPhase('Results');
            
            const sortedTeams = [...gameData.teams].sort((a, b) => b.budget - a.budget);
            
            const resultsContainer = document.getElementById('resultsContainer');
            resultsContainer.innerHTML = '';
            
            sortedTeams.forEach((team, index) => {
                const teamCard = document.createElement('div');
                teamCard.className = `team-card ${team.survived && index < 3 ? 'winner' : ''}`;
                
                teamCard.innerHTML = `
                    <h3>${index + 1}. ${team.role} ${team.survived && index < 3 ? 'üèÜ' : ''}</h3>
                    <div class="budget">${formatMoney(team.budget)}</div>
                    <div><strong>–°—Ç–∞—Ç—É—Å:</strong> ${team.survived ? '‚úÖ –í—ã–∂–∏–ª' : 'üíÄ –í—ã–±—ã–ª'}</div>
                    <div><strong>–°—Ç—Ä–∞—Ö–æ–≤–æ–∫:</strong> ${team.insurances.length}</div>
                    <div><strong>–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è:</strong> ${team.achievements.length}</div>
                    ${team.survived && index < 3 ? 
                        '<div style="color: var(--success); font-weight: bold;">üéâ –ü–û–ü–ê–õ –í –ë–£–ù–ö–ï–†!</div>' : 
                        ''}
                    ${!team.survived ? 
                        '<div style="color: var(--secondary); font-weight: bold;">üíÄ –ù–ï –í–´–ñ–ò–õ</div>' : 
                        ''}
                `;
                
                resultsContainer.appendChild(teamCard);
            });
        }

        function restartGame() {
            gameData.teams.forEach(team => {
                team.budget = getInitialBudget(team.role);
                team.insurances = [];
                team.survived = true;
                team.achievements = [];
            });
            gameData.usedEvents = [];
            gameData.combo = 0;
            gameData.eventCount = 0;
            
            switchPhase('Insurance');
            initializeGame();
        }

        function getInitialBudget(role) {
            const budgets = {
                "–ú–æ–ª–æ–¥–∞—è —Å–µ–º—å—è": 2000000,
                "–§—Ä–∏–ª–∞–Ω—Å–µ—Ä": 1200000,
                "–ü—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—å": 3500000,
                "–í—Ä–∞—á": 1800000,
                "–í–æ–¥–∏—Ç–µ–ª—å": 1500000,
                "–ü–µ–Ω—Å–∏–æ–Ω–µ—Ä": 1000000
            };
            return budgets[role];
        }

        window.onload = initializeGame;
    </script>
</body>
</html>